class Edge{constructor(t,e,i,s,l,n){this.x1=t,this.y1=e,this.x2=i,this.y2=s,this.len=sqrt(pow(t-i,2)+pow(e-s,2)),this.color=color(0,0,0),this.size=4,this.width=this.size,this.edgetype=l,this.dashlength=4,this.element=n}animate(t,e){let i;return sqDistToLine(t,e,this.x1,this.y1,this.x2,this.y2)<pow(this.width,2)?(this.width=lerp(this.width,1.5*this.size,.1),i=!0):(this.width=lerp(this.width,this.size,.1),i=!1),i}show(){if("solid"==this.edgetype)stroke(this.color),strokeWeight(this.width),line(this.x1,this.y1,this.x2,this.y2);else if("dashed"==this.edgetype){let t=this.len/(2*(this.dashlength+3*this.size));for(let e=0;e<t;e++){let i=map(e,0,t,this.x1,this.x2),s=map(e,0,t,this.y1,this.y2),l=i+(this.x2-this.x1)/(2*t),n=s+(this.y2-this.y1)/(2*t);((l-this.x2)*(this.x2-this.x1)>0||(n-this.y2)*(this.y2-this.y1)>0)&&(l=this.x2,n=this.y2),stroke(this.color),strokeWeight(this.width),line(i,s,l,n)}}else if("arrow"==this.edgetype){stroke(this.color),strokeWeight(this.width),line(this.x1,this.y1,this.x2,this.y2),push(),fill(this.color),translate(this.x1,this.y1);let t=atan2(this.y2-this.y1,this.x2-this.x1);rotate(t),triangle(5,0,20,1.2*this.width,20,-1.2*this.width),pop()}else if("doublearrow"==this.edgetype){let t;stroke(this.color),strokeWeight(this.width),line(this.x1,this.y1,this.x2,this.y2),push(),fill(this.color),translate(this.x1,this.y1),t=atan2(this.y2-this.y1,this.x2-this.x1),rotate(t),triangle(5,0,20,1.2*this.width,20,-1.2*this.width),pop(),push(),fill(this.color),translate(this.x2,this.y2),t=atan2(this.y1-this.y2,this.x1-this.x2),rotate(t),triangle(5,0,20,1.2*this.width,20,-1.2*this.width),pop()}}click(t,e,i){if(sqDistToLine(t,e,this.x1,this.y1,this.x2,this.y2)<pow(this.width,2)){i&&i.style("display","none"),this.element&&this.element.style("display","");for(let t=0;t<rlist.length;t++)rlist[t].highlight(!1);return this.element}return!1}}class Region{constructor(t,e,i,s,l,n,o,h,r,a,c){this.x1=t,this.y1=e,this.x2=i,this.y2=s,this.label=l,this.curve=n,this.xstart=o,this.xend=h,this.catlabel=r,this.element=a,this.highlighted=!1,this.color=c}animate(t,e){return t>this.x1&&t<this.x2&&e>this.y1&&e<this.y2}show(){noFill(),strokeWeight(6),stroke(this.color),beginShape(),vertex(this.xstart,height+10);for(let t=this.xstart;t<=this.xend;t+=5)vertex(t,this.curve(t));vertex(this.xend,height+10),endShape(),fill(this.color),textSize(20),textFont("Helvetica"),textStyle(BOLD),stroke(255),strokeWeight(1),text(this.label,this.x1,this.y1,this.x2,this.y2)}showHighlight(){if(this.highlighted){noStroke(),fill(200),beginShape(),vertex(this.xstart,height+10);for(let t=this.xstart;t<=this.xend;t+=5)vertex(t,this.curve(t));vertex(this.xend,height+10),endShape(CLOSE)}}click(t,e,i){if(t>this.x1&&t<this.x2&&e>this.y1&&e<this.y2){i&&i.style("display","none"),this.element&&this.element.style("display","");for(let t=0;t<rlist.length;t++)rlist[t].highlight(!1);return this.highlight(!0),this.element}return!1}highlight(t){if(this.highlighted=t,t)for(let t=0;t<vlist.length;t++)vlist[t].cats.indexOf(this.catlabel);else for(let t=0;t<vlist.length;t++)vlist[t].highlighted=!1}}let shownElement,isHover,goBackRegion,countRegion,vlist=[],elist=[],rlist=[],vdict={},edict={},vlistcount=[],elistcount=[],isCountDisplay=!1;function preload(){for(let t=0;t<data.equiv.length;t++)item=data.equiv[t],vdict[item.id]=loadStrings("equiv/"+item.id+".html");for(let t=0;t<data.reduc.length;t++)item=data.reduc[t],edict[item.id]=loadStrings("reduc/"+item.id+".html")}function setup(){canvas=createCanvas(1200,800),canvas.parent("canvasContainer");let t=select("#body");for(let e=0;e<data.equiv.length;e++){if(item=data.equiv[e],element=createDiv(),element.id(item.id),element.style("display","none"),element.parent(t),item.id in vdict){let t=vdict[item.id],e=t.indexOf("<body>")+1,i=t.indexOf("</body>"),s=t.slice(e,i).join("\n");element.html(s)}if(item.categories.indexOf("countable")>=0){vlistcount.push(new Vertex(item.pos[0],item.pos[1],item.name,item.label,item.labeloffset,item.categories,element));for(let t=0;t<item.categories.length;t++)cat=item.categories[t],addHTMLCats(element,cat)}else{vlist.push(new Vertex(item.pos[0],item.pos[1],item.name,item.label,item.labeloffset,item.categories,element));for(let t=0;t<item.categories.length;t++)cat=item.categories[t],addHTMLCats(element,cat)}element.changed(t=>{console.log("change"),console.log(t)})}for(let e=0;e<data.reduc.length;e++){if(item=data.reduc[e],element=createDiv(),element.id(item.id),element.style("display","none"),element.parent(t),item.id in edict){let t=edict[item.id],e=t.indexOf("<body>")+1,i=t.indexOf("</body>"),s=t.slice(e,i).join("\n");element.html(s)}let i,s,l,n;if(item.countable){for(let t=0;t<vlistcount.length;t++)null==i&&vlistcount[t].label==item.upperlabel&&(i=[vlistcount[t].x,vlistcount[t].y],l=t),null==s&&vlistcount[t].label==item.lowerlabel&&(s=[vlistcount[t].x,vlistcount[t].y],n=t);null!=i&&null!=s?(elistcount.push(new Edge(i[0],i[1],s[0],s[1],item.edgetype,element)),addHTMLReducs(l,n,vlistcount,item.id)):(console.log(item),console.error("Couldn't find upper and lower vertex"))}else{for(let t=0;t<vlist.length;t++)null==i&&vlist[t].label==item.upperlabel&&(i=[vlist[t].x,vlist[t].y],l=t),null==s&&vlist[t].label==item.lowerlabel&&(s=[vlist[t].x,vlist[t].y],n=t);null!=i&&null!=s?(elist.push(new Edge(i[0],i[1],s[0],s[1],item.edgetype,element)),addHTMLReducs(l,n,vlist,item.id)):(console.log(item),console.error("Couldn't find upper and lower vertex"))}}if(element=select("#sinf"),rlist.push(new Region(1100,700,1200,750,"S Infinity",t=>(t-600)*(t-600)/1200+600,100,1100,"sinf",element,color(0,0,200))),element=select("#borel"),rlist.push(new Region(50,250,100,300,"Borel",t=>t*t/1e3+200,-100,1e3,"borel",element,color(200,0,0))),element=select("#polish"),rlist.push(new Region(1e3,200,1100,250,"Polish group actions",t=>(t-1050)*(t-1050)/1500+200,50,1250,"polish",element,color(0,200,0))),countRegion=new Region(300,720,350,750,"Countable",t=>(t-350)*(t-350)/500+690,100,600,"countable",null,color(0,200,200)),goBackRegion=new Region(1e3,50,1100,100,"Go Back",t=>(t-600)*(t-600)/4e3+50,-50,1250,"goback",null,color(0,200,200)),window.location.href.indexOf("?id=")>-1){let t=getUrlVars().id;(shownElement=select("#"+t)).style("display","")}}function draw(){background(150);let t=mouseX,e=mouseY;if(fill(255),stroke(0),strokeWeight(2),textSize(14),text(String(floor(t))+", "+String(floor(e)),1120,790),isCountDisplay){1==isHover&&(document.getElementById("canvasContainer").style.cursor="default",isHover=!1),canvas.removeAttribute("title");for(let i=0;i<vlistcount.length;i++)vlistcount[i].animate(t,e)&&(isHover=!0,document.getElementById("canvasContainer").style.cursor="pointer",canvas.attribute("title",vlistcount[i].name));goBackRegion.animate(t,e)&&(isHover=!0,document.getElementById("canvasContainer").style.cursor="pointer"),goBackRegion.show(),isHover&&(t-=2*width,e-=2*height);for(let i=0;i<elistcount.length;i++)elistcount[i].animate(t,e)&&(isHover=!0,document.getElementById("canvasContainer").style.cursor="pointer"),elistcount[i].show();for(let t=0;t<vlistcount.length;t++)vlistcount[t].show()}else{1==isHover&&(document.getElementById("canvasContainer").style.cursor="default",isHover=!1),canvas.removeAttribute("title");for(let i=0;i<vlist.length;i++)vlist[i].animate(t,e)&&(isHover=!0,document.getElementById("canvasContainer").style.cursor="pointer",canvas.attribute("title",vlist[i].name));for(let t=0;t<rlist.length;t++)rlist[t].showHighlight();for(let i=0;i<rlist.length;i++)rlist[i].animate(t,e)&&(isHover=!0,document.getElementById("canvasContainer").style.cursor="pointer"),rlist[i].show();countRegion.animate(t,e)&&(isHover=!0,document.getElementById("canvasContainer").style.cursor="pointer"),countRegion.show(),isHover&&(t-=2*width,e-=2*height);for(let i=0;i<elist.length;i++)elist[i].animate(t,e)&&(isHover=!0,document.getElementById("canvasContainer").style.cursor="pointer"),elist[i].show();for(let t=0;t<vlist.length;t++)vlist[t].show()}}function mouseClicked(){let t,e=mouseX,i=mouseY;if(isCountDisplay){for(let s=0;s<vlistcount.length;s++)if(!1!==(t=vlistcount[s].click(e,i,shownElement))){shownElement=t,t=!0;break}if(!t)for(let s=0;s<elistcount.length;s++)if(!1!==(t=elistcount[s].click(e,i,shownElement))){shownElement=t,t=!0;break}if(t&&updateURL(shownElement.id()),!t){!1!==goBackRegion.click(e,i,shownElement)&&(shownElement=void 0,isCountDisplay=!1,updateURL())}}else{for(let s=0;s<vlist.length;s++)if(!1!==(t=vlist[s].click(e,i,shownElement))){shownElement=t,t=!0;break}if(!t)for(let s=0;s<elist.length;s++)if(!1!==(t=elist[s].click(e,i,shownElement))){shownElement=t,t=!0;break}if(!t)for(let s=0;s<rlist.length;s++)if(!1!==(t=rlist[s].click(e,i,shownElement))){shownElement=t,t=!0;break}if(t&&updateURL(shownElement.id()),!t){!1!==countRegion.click(e,i,shownElement)&&(shownElement=void 0,isCountDisplay=!0,updateURL())}}}function sqDistToLine(t,e,i,s,l,n){let o,h=(l-i)*(l-i)+(n-s)*(n-s),r=((t-i)*(l-i)+(e-s)*(n-s))/h;return o=r>0&&r<1?pow(t-i,2)+pow(e-s,2)-r*r*h:1/0}function getUrlVars(){var t={};window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(e,i,s){t[i]=s});return t}function updateURL(t){if(history.pushState)if(t){var e=window.location.protocol+"//"+window.location.host+window.location.pathname+"?id="+t;window.history.pushState({path:e},"",e)}else{e=window.location.protocol+"//"+window.location.host+window.location.pathname;window.history.pushState({path:e},"",e)}}function addHTMLReducs(t,e,i,s){let l=i[e].element.html(),n=l.indexOf("</h2>",l.indexOf('id="reducible-to"'))+5,o='<p><a href="./?id='+s+'">'+i[t].name+"</a></p>\n",h=[l.slice(0,n),o,l.slice(n)].join("");i[e].element.html(h),n=(l=i[t].element.html()).indexOf("</h2>",l.indexOf('id="reducible-from"'))+5,o='<p><a href="./?id='+s+'">'+i[e].name+"</a></p>\n",h=[l.slice(0,n),o,l.slice(n)].join(""),i[t].element.html(h)}function addHTMLCats(t,e){let i,s=t.html();if("sinf"==e)i='<p><a href="./?id='+e+'">S Infinity</a></p>';else if("borel"==e)i='<p><a href="./?id='+e+'">Borel</a></p>';else{if("polish"!=e)return;i='<p><a href="./?id='+e+'">Polish group actions</a></p>'}t.html(s+i)}function showAndRender(t){t.style("display",""),MathJax.Hub.Queue(["Typeset",MathJax.Hub,t.id()]),console.log("render")}class Vertex{constructor(t,e,i,s,l,n,o){this.x=t,this.y=e,this.color=color(255,255,255),this.size=6,this.r=this.size,this.name=i,this.label=s,this.cats=n,this.labeloff=l,this.element=o,this.highlighted=!1}animate(t,e){let i;return pow(t-this.x,2)+pow(e-this.y,2)<pow(this.r,2)?(this.r=lerp(this.r,1.5*this.size,.1),i=!0):(this.r=lerp(this.r,this.size,.1),i=!1),i}show(){fill(this.color),this.highlighted&&fill(200,0,200),stroke(0),strokeWeight(2*this.r/this.size),circle(this.x,this.y,2*this.r),fill(255),textSize(16),strokeWeight(2),text(this.label,this.x+this.labeloff[0],this.y+this.labeloff[1])}click(t,e,i){if(pow(t-this.x,2)+pow(e-this.y,2)<pow(this.r,2)){i&&i.style("display","none"),this.element&&showAndRender(this.element);for(let t=0;t<rlist.length;t++)rlist[t].highlight(!1);return this.element}return!1}}